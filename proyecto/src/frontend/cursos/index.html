<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="/static/manifest.json" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="/static/css/students-theme.css" />
  <link rel="stylesheet" href="/static/css/styles.css" />
  <link rel="stylesheet" href="cursos.css" />
  <meta name="theme-color" content="#1a1a1a">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="dark">
  <title>Cursos - StudentsPoint</title>
</head>
<body>
  <!-- Fondo de partículas -->
  <div class="particles-bg"></div>

  <!-- Header compacto -->
  <header class="students-header text-white">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <div class="students-logo">
            <div class="logo-placeholder">
              <i class="fas fa-graduation-cap fa-2x"></i>
            </div>
            <div>
              <h1>Cursos StudentsPoint</h1>
              <p>Amplía tus conocimientos y habilidades</p>
            </div>
          </div>
        </div>
        <div class="col-md-4 text-end">
          <div class="auth-buttons">
            <a href="/" class="btn btn-outline-primary btn-sm">
              <i class="fas fa-home"></i> Inicio
            </a>
            <a href="/login.html" class="btn btn-primary btn-sm">
              <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
            </a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Navegación compacta -->
  <nav class="navbar navbar-expand-lg students-nav">
    <div class="container">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
              <i class="fas fa-th-large"></i> Aplicaciones
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="/forum/">
                <i class="fas fa-comments"></i> Foros
              </a></li>
              <li><a class="dropdown-item" href="/market/">
                <i class="fas fa-store"></i> Mercado
              </a></li>
              <li><a class="dropdown-item" href="/portfolio/">
                <i class="fas fa-briefcase"></i> Portafolio
              </a></li>
              <li><a class="dropdown-item" href="/bienestar/">
                <i class="fas fa-heart-pulse"></i> Bienestar
              </a></li>
              <li><a class="dropdown-item" href="/cursos/">
                <i class="fas fa-graduation-cap"></i> Cursos
              </a></li>
              <li><a class="dropdown-item" href="/horarios/">
                <i class="fas fa-calendar"></i> Horarios
              </a></li>
              <li><a class="dropdown-item" href="/encuestas/">
                <i class="fas fa-poll"></i> Encuestas
              </a></li>
              <li><a class="dropdown-item" href="/reportes/">
                <i class="fas fa-chart-bar"></i> Reportes
              </a></li>
              <li><a class="dropdown-item" href="/streetview/">
                <i class="fas fa-map"></i> Recorridos Virtuales
              </a></li>
              <li><a class="dropdown-item" href="/campuses.html">
                <i class="fas fa-building"></i> Sedes
              </a></li>
              <li><a class="dropdown-item" href="/teachers.html">
                <i class="fas fa-chalkboard-teacher"></i> Profesores
              </a></li>
              <li><a class="dropdown-item" href="/account.html">
                <i class="fas fa-user"></i> Mi Cuenta
              </a></li>
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/cursos/?tipo=otec">
              <i class="fas fa-certificate"></i> OTEC
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/cursos/?tipo=externos">
              <i class="fas fa-external-link-alt"></i> Externos
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/cursos/?tipo=gratuitos">
              <i class="fas fa-gift"></i> Gratuitos
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Contenido principal -->
  <main class="main-content" style="position: relative; z-index: 2;">
    <div class="container mt-3">
      <!-- Filtros y búsqueda -->
      <div class="row mb-3">
        <div class="col-md-6">
          <div class="input-group">
            <input type="text" class="form-control" id="searchInput" placeholder="Buscar cursos...">
            <button class="btn btn-primary" type="button" onclick="searchCourses()">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </div>
        <div class="col-md-6 text-end">
          <button class="btn btn-primary" onclick="showMyCourses()">
            <i class="fas fa-user-graduate"></i> Mis Cursos
          </button>
        </div>
      </div>

      <!-- Categorías -->
      <div class="row mb-3">
        <div class="col-12">
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-outline-primary active" onclick="filterByType('all')">
              Todos
            </button>
            <button type="button" class="btn btn-outline-primary" onclick="filterByType('otec')">
              OTEC
            </button>
            <button type="button" class="btn btn-outline-primary" onclick="filterByType('externos')">
              Externos
            </button>
            <button type="button" class="btn btn-outline-primary" onclick="filterByType('gratuitos')">
              Gratuitos
            </button>
          </div>
        </div>
      </div>

      <!-- Lista de cursos -->
      <div class="row">
        <div class="col-12">
          <div id="coursesContainer">
            <!-- Los cursos se cargarán aquí dinámicamente -->
            <div class="text-center py-4">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
              </div>
              <p class="mt-2 text-muted">Cargando cursos...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer compacto -->
  <footer class="students-footer">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-6">
          <h5 class="gradient-text">Cursos StudentsPoint</h5>
          <p>Amplía tus conocimientos y habilidades.</p>
        </div>
        <div class="col-md-6 text-end">
          <p class="mb-0">
            <i class="fas fa-graduation-cap"></i> Aprende y crece profesionalmente
          </p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Herramientas de desarrollo -->
  <div class="dev-tools" style="display: none;">
    <button onclick="window.StudentsPointPWA?.clearCache()" title="Limpiar Cache">
      <i class="fas fa-sync-alt"></i>
    </button>
    <button onclick="window.StudentsPointPWA?.getVersion()" title="Versión">
      <i class="fas fa-info-circle"></i>
    </button>
    <button onclick="window.open('/admin/', '_blank')" title="Administración">
      <i class="fas fa-cog"></i>
    </button>
    <button onclick="window.open('/api/', '_blank')" title="API">
      <i class="fas fa-code"></i>
    </button>
  </div>

  <!-- Modal para detalles del curso -->
  <div class="modal fade" id="courseModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="courseModalTitle">Curso</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="courseModalBody">
          <!-- Contenido del curso se cargará aquí -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button type="button" class="btn btn-primary" id="enrollBtn">Inscribirse</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/static/js/sounds.js"></script>
  <script src="/static/js/pwa.js"></script>
  <script src="/static/pwa-config.js"></script>
  <script src="/static/js/main.js"></script>

  <script>
    // Mostrar herramientas de desarrollo solo en localhost
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
      document.querySelector('.dev-tools').style.display = 'flex';
    }

    // Variables globales
    let currentType = 'all';
    let courses = [];

    // Cargar cursos al iniciar
    document.addEventListener('DOMContentLoaded', function() {
      loadCourses();
      
      // Sonido de carga de página
      setTimeout(() => {
        if (window.playSound) {
          window.playSound('pageLoad');
        }
      }, 500);
    });

    // Cargar cursos desde la API
    async function loadCourses() {
      try {
        const response = await fetch('/api/courses/');
        if (response.ok) {
          courses = await response.json();
          displayCourses(courses);
        } else {
          // Datos de ejemplo si la API no está disponible
          courses = getSampleCourses();
          displayCourses(courses);
        }
      } catch (error) {
        console.error('Error:', error);
        courses = getSampleCourses();
        displayCourses(courses);
      }
    }

    // Obtener cursos de ejemplo
    function getSampleCourses() {
      return [
        {
          id: 1,
          nombre: 'Desarrollo Web con React',
          descripcion: 'Aprende a crear aplicaciones web modernas con React y JavaScript.',
          tipo: 'otec',
          duracion: '40 horas',
          precio: '$150.000',
          instructor: 'Juan Pérez',
          fecha_inicio: '2024-02-15',
          cupos: 25,
          inscritos: 18,
          nivel: 'Intermedio'
        },
        {
          id: 2,
          nombre: 'Python para Data Science',
          descripcion: 'Introducción al análisis de datos con Python y pandas.',
          tipo: 'externos',
          duracion: '60 horas',
          precio: '$200.000',
          instructor: 'María González',
          fecha_inicio: '2024-03-01',
          cupos: 20,
          inscritos: 15,
          nivel: 'Principiante'
        },
        {
          id: 3,
          nombre: 'Marketing Digital',
          descripcion: 'Estrategias de marketing digital y redes sociales.',
          tipo: 'gratuitos',
          duracion: '30 horas',
          precio: 'Gratuito',
          instructor: 'Carlos López',
          fecha_inicio: '2024-02-20',
          cupos: 50,
          inscritos: 35,
          nivel: 'Principiante'
        },
        {
          id: 4,
          nombre: 'Diseño UX/UI',
          descripcion: 'Principios de diseño de experiencia de usuario.',
          tipo: 'otec',
          duracion: '45 horas',
          precio: '$180.000',
          instructor: 'Ana Rodríguez',
          fecha_inicio: '2024-03-10',
          cupos: 15,
          inscritos: 12,
          nivel: 'Intermedio'
        }
      ];
    }

    // Mostrar cursos
    function displayCourses(coursesToShow) {
      const container = document.getElementById('coursesContainer');
      
      if (coursesToShow.length === 0) {
        container.innerHTML = `
          <div class="text-center py-4">
            <i class="fas fa-graduation-cap fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">No hay cursos disponibles</h5>
            <p class="text-muted">Pronto tendremos más cursos para ti</p>
          </div>
        `;
        return;
      }

      const coursesHTML = coursesToShow.map(course => `
        <div class="card mb-3 course-card" onclick="openCourse(${course.id})">
          <div class="card-body">
            <div class="row">
              <div class="col-md-8">
                <h5 class="card-title">${course.nombre}</h5>
                <p class="card-text text-muted">${course.descripcion}</p>
                <div class="d-flex gap-3 flex-wrap">
                  <span class="badge bg-primary">${course.tipo.toUpperCase()}</span>
                  <span class="badge bg-secondary">${course.nivel}</span>
                  <small class="text-muted">
                    <i class="fas fa-clock"></i> ${course.duracion}
                  </small>
                  <small class="text-muted">
                    <i class="fas fa-user"></i> ${course.instructor}
                  </small>
                  <small class="text-muted">
                    <i class="fas fa-calendar"></i> ${new Date(course.fecha_inicio).toLocaleDateString()}
                  </small>
                </div>
              </div>
              <div class="col-md-4 text-end">
                <div class="d-flex flex-column gap-2">
                  <h4 class="text-success mb-0">${course.precio}</h4>
                  <div class="progress mb-2" style="height: 8px;">
                    <div class="progress-bar" style="width: ${(course.inscritos / course.cupos) * 100}%"></div>
                  </div>
                  <small class="text-muted">${course.inscritos}/${course.cupos} cupos</small>
                  <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); enrollCourse(${course.id})">
                    <i class="fas fa-user-plus"></i> Inscribirse
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      `).join('');

      container.innerHTML = coursesHTML;

      // Agregar efectos hover con sonido
      const courseCards = document.querySelectorAll('.course-card');
      courseCards.forEach(card => {
        card.addEventListener('mouseenter', () => {
          if (window.playSound) {
            window.playSound('hover');
          }
        });
      });
    }

    // Filtrar por tipo
    function filterByType(type) {
      currentType = type;
      
      // Actualizar botones activos
      document.querySelectorAll('.btn-group .btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Filtrar cursos
      let filteredCourses = courses;
      if (type !== 'all') {
        filteredCourses = courses.filter(course => course.tipo === type);
      }
      
      displayCourses(filteredCourses);
      
      if (window.playSound) {
        window.playSound('click');
      }
    }

    // Buscar cursos
    function searchCourses() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      
      if (searchTerm === '') {
        displayCourses(courses);
        return;
      }
      
      const filteredCourses = courses.filter(course => 
        course.nombre.toLowerCase().includes(searchTerm) ||
        course.descripcion.toLowerCase().includes(searchTerm) ||
        course.instructor.toLowerCase().includes(searchTerm)
      );
      
      displayCourses(filteredCourses);
      
      if (window.playSound) {
        window.playSound('search');
      }
    }

    // Abrir curso
    function openCourse(courseId) {
      const course = courses.find(c => c.id === courseId);
      if (course) {
        document.getElementById('courseModalTitle').textContent = course.nombre;
        document.getElementById('courseModalBody').innerHTML = `
          <div class="row">
            <div class="col-md-6">
              <h6>Descripción</h6>
              <p>${course.descripcion}</p>
              
              <h6>Detalles</h6>
              <ul class="list-unstyled">
                <li><strong>Duración:</strong> ${course.duracion}</li>
                <li><strong>Nivel:</strong> ${course.nivel}</li>
                <li><strong>Instructor:</strong> ${course.instructor}</li>
                <li><strong>Fecha de inicio:</strong> ${new Date(course.fecha_inicio).toLocaleDateString()}</li>
                <li><strong>Cupos disponibles:</strong> ${course.cupos - course.inscritos}</li>
              </ul>
            </div>
            <div class="col-md-6">
              <h6>Precio</h6>
              <h3 class="text-success">${course.precio}</h3>
              
              <h6>Progreso de inscripciones</h6>
              <div class="progress mb-3">
                <div class="progress-bar" style="width: ${(course.inscritos / course.cupos) * 100}%"></div>
              </div>
              <p class="text-muted">${course.inscritos} de ${course.cupos} cupos ocupados</p>
            </div>
          </div>
        `;
        
        const modal = new bootstrap.Modal(document.getElementById('courseModal'));
        modal.show();
        
        if (window.playSound) {
          window.playSound('click');
        }
      }
    }

    // Inscribirse en curso
    function enrollCourse(courseId) {
      const course = courses.find(c => c.id === courseId);
      if (course) {
        if (course.inscritos >= course.cupos) {
          showError('No hay cupos disponibles para este curso');
          return;
        }
        
        showSuccess(`Te has inscrito exitosamente en "${course.nombre}"`);
        
        if (window.playSound) {
          window.playSound('success');
        }
      }
    }

    // Mostrar mis cursos
    function showMyCourses() {
      showSuccess('Función de "Mis Cursos" en desarrollo');
      
      if (window.playSound) {
        window.playSound('click');
      }
    }

    // Mostrar error
    function showError(message) {
      const alertDiv = document.createElement('div');
      alertDiv.className = 'alert alert-danger alert-dismissible fade show';
      alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      
      const container = document.querySelector('.container');
      container.insertBefore(alertDiv, container.firstChild);
      
      setTimeout(() => {
        if (alertDiv.parentNode) {
          alertDiv.remove();
        }
      }, 5000);
    }

    // Mostrar éxito
    function showSuccess(message) {
      const alertDiv = document.createElement('div');
      alertDiv.className = 'alert alert-success alert-dismissible fade show';
      alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      
      const container = document.querySelector('.container');
      container.insertBefore(alertDiv, container.firstChild);
      
      setTimeout(() => {
        if (alertDiv.parentNode) {
          alertDiv.remove();
        }
      }, 3000);
    }

    // Búsqueda con Enter
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        searchCourses();
      }
    });
  </script>
</body>
</html>